<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Wishlist - Personal Wishlist Manager</title>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
      color: #333;
      overflow-x: hidden;
    }

    .app-container {
      width: 100%;
      min-height: 100%;
      overflow-y: auto;
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loading-overlay.active {
      display: flex;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: white;
      color: #333;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      display: none;
      align-items: center;
      gap: 12px;
      z-index: 10000;
      animation: slideInUp 0.3s ease-out;
      max-width: 400px;
    }

    .toast.active {
      display: flex;
    }

    .toast.success {
      border-left: 4px solid #10b981;
    }

    .toast.error {
      border-left: 4px solid #ef4444;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Login & Register Page */
    .auth-page {
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .auth-card {
      background: white;
      border-radius: 24px;
      padding: 48px 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 440px;
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }
      100% {
        background-position: 1000px 0;
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes glow {
      0%, 100% {
        box-shadow: 0 0 5px rgba(139, 0, 0, 0.5), 0 0 10px rgba(139, 0, 0, 0.3);
      }
      50% {
        box-shadow: 0 0 20px rgba(139, 0, 0, 0.8), 0 0 30px rgba(139, 0, 0, 0.5);
      }
    }

    .auth-logo {
      text-align: center;
      margin-bottom: 32px;
      animation: float 3s ease-in-out infinite;
    }

    .auth-logo h1 {
      color: #4A0404;
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #4A0404 0%, #8B0000 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .auth-logo p {
      color: #666;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    .form-group input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #E5E5E5;
      border-radius: 12px;
      font-size: 15px;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: #4A0404;
      box-shadow: 0 0 0 4px rgba(74, 4, 4, 0.15);
      transform: translateY(-2px);
    }

    .password-wrapper {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      padding: 4px;
      color: #666;
      transition: all 0.3s ease;
    }

    .password-toggle:hover {
      color: #4A0404;
      transform: translateY(-50%) scale(1.1);
    }

    .btn-primary {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #4A0404 0%, #6B0505 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.4s ease;
      font-family: 'Poppins', sans-serif;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(74, 4, 4, 0.4);
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .btn-primary:hover::before {
      left: 100%;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #6B0505 0%, #8B0000 100%);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(74, 4, 4, 0.5);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 4px 15px rgba(74, 4, 4, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .auth-switch {
      text-align: center;
      margin-top: 24px;
      color: #666;
      font-size: 14px;
    }

    .auth-switch a {
      color: #4A0404;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .auth-switch a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #4A0404, #8B0000);
      transition: width 0.3s ease;
    }

    .auth-switch a:hover {
      color: #6B0505;
    }

    .auth-switch a:hover::after {
      width: 100%;
    }

    .error-message {
      background: #FFE5E5;
      color: #C00000;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .success-message {
      background: #E5F5E5;
      color: #008000;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    /* Main App Layout */
    .main-app {
      display: none;
      width: 100%;
      min-height: 100%;
      background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
    }

    .header {
      background: linear-gradient(135deg, #4A0404 0%, #6B0505 100%);
      padding: 20px 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 3px solid #8B0000;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-logo h1 {
      color: white;
      font-size: 28px;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      animation: float 3s ease-in-out infinite;
    }

    .header-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    @media (max-width: 768px) {
      .header-info {
        gap: 8px;
        justify-content: flex-end;
      }
    }

    .btn-dark-mode {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      padding: 10px 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      backdrop-filter: blur(10px);
      font-size: 16px;
    }
    
    @media (max-width: 768px) {
      .btn-dark-mode {
        padding: 8px 12px;
        font-size: 14px;
      }
    }

    .btn-dark-mode:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px) rotate(20deg);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .total-price {
      background: linear-gradient(135deg, #8B0000 0%, #A00000 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 6px 20px rgba(139, 0, 0, 0.5);
      animation: pulse 2s ease-in-out infinite;
      border: 2px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }
    
    @media (max-width: 768px) {
      .total-price {
        padding: 8px 14px;
        font-size: 12px;
      }
    }

    .total-price::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: shimmer 3s linear infinite;
    }

    .btn-logout {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      padding: 10px 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      backdrop-filter: blur(10px);
      font-size: 14px;
    }
    
    @media (max-width: 768px) {
      .btn-logout {
        padding: 8px 14px;
        font-size: 12px;
      }
    }

    .btn-logout:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* Main Content */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .breadcrumb {
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      animation: slideInLeft 0.4s ease-out;
    }

    .breadcrumb-item {
      color: #666;
      text-decoration: none;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      padding: 6px 12px;
      border-radius: 8px;
    }

    .breadcrumb-item:hover {
      color: #333;
      background: rgba(74, 4, 4, 0.05);
      transform: translateX(3px);
    }

    .breadcrumb-item.active {
      color: #4A0404;
      font-weight: 600;
      background: rgba(74, 4, 4, 0.1);
    }

    .breadcrumb-separator {
      color: #999;
      font-weight: bold;
    }

    .page-header {
      margin-bottom: 32px;
      animation: slideInLeft 0.6s ease-out;
    }

    .page-title {
      font-size: 36px;
      color: #333;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .page-subtitle {
      color: #666;
      font-size: 16px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      margin-bottom: 32px;
      flex-wrap: wrap;
    }

    .btn-add {
      background: linear-gradient(135deg, #4A0404 0%, #6B0505 100%);
      color: white;
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.4s ease;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
      box-shadow: 0 4px 15px rgba(74, 4, 4, 0.3);
      position: relative;
      overflow: hidden;
    }

    .btn-add::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .btn-add:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-add:hover {
      background: linear-gradient(135deg, #6B0505 0%, #8B0000 100%);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(74, 4, 4, 0.4);
    }

    /* Category Grid */
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    @media (max-width: 768px) {
      .category-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
      }
    }

    .category-card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(139, 0, 0, 0.3);
      cursor: pointer;
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      animation: fadeIn 0.6s ease-out backwards;
      border: 2px solid transparent;
    }

    .category-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(74, 4, 4, 0.2) 0%, rgba(139, 0, 0, 0.2) 100%);
      opacity: 0;
      transition: opacity 0.4s ease;
      z-index: 1;
      pointer-events: none;
    }

    .category-card::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, #4A0404, #8B0000, #4A0404);
      border-radius: 20px;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.4s ease;
      background-size: 300% 300%;
      animation: glow 3s ease-in-out infinite;
    }

    .category-card:hover::after {
      opacity: 1;
    }

    .category-card:hover::before {
      opacity: 1;
    }

    .category-card:hover {
      transform: translateY(-15px) scale(1.03) rotate(1deg);
      box-shadow: 0 25px 50px rgba(139, 0, 0, 0.4);
    }

    .category-cover {
      width: 100%;
      height: 180px;
      object-fit: cover;
      background: linear-gradient(135deg, #4A0404 0%, #6B0505 50%, #8B0000 100%);
      transition: transform 0.5s ease;
      position: relative;
    }
    
    @media (max-width: 768px) {
      .category-cover {
        height: 100px;
      }
    }

    .category-card:hover .category-cover {
      transform: scale(1.1);
    }

    .category-info {
      padding: 24px;
      position: relative;
      z-index: 2;
    }
    
    @media (max-width: 768px) {
      .category-info {
        padding: 12px;
      }
    }

    .category-name {
      font-size: 20px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
      transition: color 0.3s ease;
    }

    .category-card:hover .category-name {
      color: #4A0404;
    }

    .category-total {
      color: #4A0404;
      font-weight: 700;
      font-size: 19px;
      background: linear-gradient(135deg, #4A0404 0%, #8B0000 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    @media (max-width: 768px) {
      .category-name {
        font-size: 14px;
        margin-bottom: 6px;
      }
      
      .category-total {
        font-size: 13px;
      }
    }

    .category-actions {
      padding: 0 20px 20px;
      display: flex;
      gap: 8px;
      position: relative;
      z-index: 10;
    }
    
    @media (max-width: 768px) {
      .category-actions {
        padding: 0 8px 8px;
        gap: 4px;
      }
    }

    .btn-icon {
      background: #F5F5F5;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 12px;
      font-family: 'Poppins', sans-serif;
      color: #666;
      position: relative;
      z-index: 10;
    }
    
    @media (max-width: 768px) {
      .btn-icon {
        padding: 6px 8px;
        font-size: 10px;
      }
    }

    .btn-icon:hover {
      background: #4A0404;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(74, 4, 4, 0.3);
    }

    /* Item Grid */
    .item-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }
    
    @media (max-width: 768px) {
      .item-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
      }
    }

    .item-card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(139, 0, 0, 0.3);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      animation: fadeIn 0.6s ease-out backwards;
      position: relative;
      border: 2px solid transparent;
    }

    .item-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(135deg, #4A0404, #8B0000, #A00000);
      border-radius: 20px;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .item-card:hover::before {
      opacity: 1;
    }

    .item-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(74, 4, 4, 0.05) 0%, rgba(139, 0, 0, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
    }

    .item-card.purchased {
      opacity: 0.7;
      filter: grayscale(0.3);
    }

    .item-card:hover::after {
      opacity: 1;
    }

    .item-card:hover {
      transform: translateY(-12px) scale(1.03);
      box-shadow: 0 20px 40px rgba(139, 0, 0, 0.4);
    }

    .item-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      background: #F5F5F5;
    }
    
    @media (max-width: 768px) {
      .item-image {
        height: 100px;
      }
    }

    .item-content {
      padding: 16px;
    }
    
    @media (max-width: 768px) {
      .item-content {
        padding: 10px;
      }
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 8px;
    }

    .item-name {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      flex: 1;
    }

    .priority-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      white-space: nowrap;
      margin-left: 8px;
    }
    
    @media (max-width: 768px) {
      .item-name {
        font-size: 12px;
      }
      
      .priority-badge {
        padding: 3px 6px;
        font-size: 8px;
        margin-left: 4px;
      }
    }

    .priority-very-important {
      background: #FFE5E5;
      color: #C00000;
    }

    .priority-important {
      background: #FFF3E5;
      color: #FF8C00;
    }

    .priority-medium {
      background: #E5F0FF;
      color: #0066CC;
    }

    .priority-low {
      background: #F0F0F0;
      color: #666;
    }

    .item-description {
      color: #666;
      font-size: 13px;
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .item-price {
      color: #4A0404;
      font-weight: 700;
      font-size: 22px;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #4A0404 0%, #8B0000 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    @media (max-width: 768px) {
      .item-description {
        font-size: 10px;
        margin-bottom: 6px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      .item-price {
        font-size: 14px;
        margin-bottom: 8px;
      }
    }

    .item-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .btn-buy {
      flex: 1;
      background: linear-gradient(135deg, #4A0404 0%, #8B0000 100%);
      color: white;
      padding: 12px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.4s ease;
      font-family: 'Poppins', sans-serif;
      font-size: 13px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(74, 4, 4, 0.4);
    }
    
    @media (max-width: 768px) {
      .btn-buy {
        padding: 8px;
        font-size: 10px;
      }
    }

    .btn-buy::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .btn-buy:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-buy:hover {
      background: linear-gradient(135deg, #6B0505 0%, #A00000 100%);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(74, 4, 4, 0.6);
    }

    .btn-buy:active {
      transform: translateY(0);
    }

    .checkbox-purchased {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #666;
      cursor: pointer;
    }

    .checkbox-purchased input {
      cursor: pointer;
      width: 18px;
      height: 18px;
    }
    
    @media (max-width: 768px) {
      .checkbox-purchased {
        font-size: 9px;
        gap: 3px;
      }
      
      .checkbox-purchased input {
        width: 14px;
        height: 14px;
      }
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 32px;
      width: 100%;
      max-width: 540px;
      max-height: 90%;
      overflow-y: auto;
      animation: modalSlide 0.3s ease-out;
    }

    @keyframes modalSlide {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .modal-header {
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #333;
    }

    .form-group textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #E5E5E5;
      border-radius: 12px;
      font-size: 15px;
      font-family: 'Poppins', sans-serif;
      resize: vertical;
      min-height: 80px;
      transition: all 0.3s ease;
    }

    .form-group textarea:focus {
      outline: none;
      border-color: #8B0000;
      box-shadow: 0 0 0 4px rgba(139, 0, 0, 0.1);
    }

    .form-group select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #E5E5E5;
      border-radius: 12px;
      font-size: 15px;
      font-family: 'Poppins', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .form-group select:focus {
      outline: none;
      border-color: #8B0000;
      box-shadow: 0 0 0 4px rgba(139, 0, 0, 0.1);
    }

    .image-upload-container {
      width: 100%;
    }

    .image-upload {
      display: block;
      width: 100%;
      padding: 40px;
      border: 3px dashed #E5E5E5;
      border-radius: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s ease;
      background: #FAFAFA;
      position: relative;
      overflow: hidden;
    }

    .image-upload::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: radial-gradient(circle, rgba(74, 4, 4, 0.1) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.5s ease, height 0.5s ease;
      border-radius: 50%;
    }

    .image-upload:hover::before {
      width: 400px;
      height: 400px;
    }

    .image-upload:hover {
      border-color: #4A0404;
      background: #FFF8F8;
      transform: scale(1.02);
      box-shadow: 0 8px 20px rgba(74, 4, 4, 0.15);
    }

    .image-upload input {
      display: none;
    }

    .image-preview {
      width: 100%;
      max-height: 250px;
      object-fit: cover;
      border-radius: 12px;
      animation: fadeIn 0.5s ease-out;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    #categoryCoverPlaceholder, #itemImagePlaceholder {
      position: relative;
      z-index: 1;
      transition: all 0.3s ease;
    }

    .image-upload:hover #categoryCoverPlaceholder,
    .image-upload:hover #itemImagePlaceholder {
      transform: scale(1.05);
      color: #4A0404;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .modal-actions button {
      flex: 1;
    }

    .btn-cancel {
      background: #F5F5F5;
      color: #333;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
    }

    .btn-cancel:hover {
      background: #E5E5E5;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: #666;
    }

    /* Dark Mode Styles */
    body.dark-mode {
      background: linear-gradient(135deg, #0D1117 0%, #161B22 100%);
    }
    
    body.dark-mode .main-app {
      background: linear-gradient(135deg, #0D1117 0%, #161B22 100%);
    }
    
    body.dark-mode .page-title {
      color: #E6EDF3;
    }
    
    body.dark-mode .page-subtitle {
      color: #8B949E;
    }
    
    body.dark-mode .breadcrumb-item {
      color: #8B949E;
    }
    
    body.dark-mode .breadcrumb-item:hover {
      color: #E6EDF3;
      background: rgba(255, 255, 255, 0.05);
    }
    
    body.dark-mode .breadcrumb-item.active {
      color: #E6EDF3;
      background: rgba(255, 255, 255, 0.1);
    }
    
    body.dark-mode .breadcrumb-separator {
      color: #6E7681;
    }
    
    body.dark-mode .empty-state {
      color: #6E7681;
    }
    
    body.dark-mode .empty-state h3 {
      color: #8B949E;
    }
    
    body.dark-mode .category-card {
      background: linear-gradient(135deg, #1A0000 0%, #2D0505 100%);
      border: 2px solid rgba(139, 0, 0, 0.3);
    }

    body.dark-mode .category-card:hover {
      border-color: rgba(139, 0, 0, 0.6);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
    }

    body.dark-mode .category-name {
      color: rgba(255, 255, 255, 0.95);
    }

    body.dark-mode .category-card:hover .category-name {
      color: white;
    }

    body.dark-mode .item-card {
      background: linear-gradient(135deg, #1A0000 0%, #2D0505 100%);
      border: 2px solid rgba(139, 0, 0, 0.3);
    }

    body.dark-mode .item-card:hover {
      border-color: rgba(139, 0, 0, 0.6);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
    }

    body.dark-mode .item-name {
      color: rgba(255, 255, 255, 0.95);
    }

    body.dark-mode .item-description {
      color: rgba(255, 255, 255, 0.7);
    }

    body.dark-mode .checkbox-purchased {
      color: rgba(255, 255, 255, 0.8);
    }

    body.dark-mode .modal-content {
      background: linear-gradient(135deg, #1A0000 0%, #2D0505 100%);
      border: 2px solid rgba(139, 0, 0, 0.5);
    }

    body.dark-mode .modal-title {
      color: white;
    }

    body.dark-mode .form-group label {
      color: rgba(255, 255, 255, 0.9);
    }

    body.dark-mode .form-group input,
    body.dark-mode .form-group textarea,
    body.dark-mode .form-group select {
      background: rgba(0, 0, 0, 0.3);
      border-color: rgba(139, 0, 0, 0.4);
      color: white;
    }

    body.dark-mode .form-group input::placeholder,
    body.dark-mode .form-group textarea::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    body.dark-mode .form-group input:focus,
    body.dark-mode .form-group textarea:focus,
    body.dark-mode .form-group select:focus {
      border-color: #8B0000;
      background: rgba(0, 0, 0, 0.4);
    }

    body.dark-mode .image-upload {
      background: rgba(0, 0, 0, 0.3);
      border-color: rgba(139, 0, 0, 0.4);
      color: rgba(255, 255, 255, 0.8);
    }

    body.dark-mode .image-upload:hover {
      background: rgba(0, 0, 0, 0.4);
      border-color: #8B0000;
    }

    body.dark-mode #categoryCoverPlaceholder,
    body.dark-mode #itemImagePlaceholder {
      color: rgba(255, 255, 255, 0.8);
    }

    body.dark-mode .btn-cancel {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    body.dark-mode .btn-cancel:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
    }

    body.dark-mode .btn-icon {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.8);
    }

    body.dark-mode .password-toggle {
      color: rgba(255, 255, 255, 0.6);
    }

    body.dark-mode .password-toggle:hover {
      color: white;
    }

    body.dark-mode .toast {
      background: #1A0000;
      color: white;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .auth-card {
        padding: 32px 24px;
      }

      .header-content {
        gap: 12px;
      }

      .modal-content {
        padding: 24px;
      }

      .page-title {
        font-size: 24px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container"><!-- Loading Overlay -->
   <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
   </div><!-- Toast Notification -->
   <div id="toast" class="toast"></div><!-- Auth Page -->
   <div id="authPage" class="auth-page">
    <div class="auth-card">
     <div class="auth-logo">
      <h1>âœ¨ My Wishlist</h1>
      <p>Kelola wishlist Anda dengan mudah</p>
     </div>
     <div id="errorMessage" class="error-message"></div>
     <div id="successMessage" class="success-message"></div><!-- Login Form -->
     <form id="loginForm">
      <div class="form-group"><label for="loginUsername">Username</label> <input type="text" id="loginUsername" placeholder="Masukkan username Anda" required>
      </div>
      <div class="form-group"><label for="loginPassword">Password</label>
       <div class="password-wrapper"><input type="password" id="loginPassword" placeholder="Masukkan password Anda" required> <button type="button" class="password-toggle" onclick="togglePassword('loginPassword', this)">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path> <circle cx="12" cy="12" r="3"></circle>
         </svg></button>
       </div>
      </div><button type="submit" class="btn-primary">Masuk</button>
      <div class="auth-switch">
       Belum punya akun? <a id="showRegister">Daftar di sini</a>
      </div>
     </form><!-- Register Form -->
     <form id="registerForm" style="display: none;">
      <div class="form-group"><label for="registerUsername">Username</label> <input type="text" id="registerUsername" placeholder="Pilih username unik" required>
      </div>
      <div class="form-group"><label for="registerPassword">Password</label>
       <div class="password-wrapper"><input type="password" id="registerPassword" placeholder="Buat password yang kuat" required> <button type="button" class="password-toggle" onclick="togglePassword('registerPassword', this)">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path> <circle cx="12" cy="12" r="3"></circle>
         </svg></button>
       </div>
      </div>
      <div class="form-group"><label for="registerConfirmPassword">Konfirmasi Password</label>
       <div class="password-wrapper"><input type="password" id="registerConfirmPassword" placeholder="Masukkan ulang password" required> <button type="button" class="password-toggle" onclick="togglePassword('registerConfirmPassword', this)">
         <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path> <circle cx="12" cy="12" r="3"></circle>
         </svg></button>
       </div>
      </div><button type="submit" class="btn-primary">Daftar</button>
      <div class="auth-switch">
       Sudah punya akun? <a id="showLogin">Masuk di sini</a>
      </div>
     </form>
    </div>
   </div><!-- Main App -->
   <div id="mainApp" class="main-app"><!-- Header -->
    <header class="header">
     <div class="header-content">
      <div class="header-logo">
       <h1>âœ¨ My Wishlist</h1>
      </div>
      <div class="header-info"><button class="btn-dark-mode" id="btnDarkMode" title="Toggle Dark Mode">ðŸŒ™</button>
       <div class="total-price">
        Total: <span id="totalPrice">Rp 0</span>
       </div><button class="btn-logout" id="btnLogout">Keluar</button>
      </div>
     </div>
    </header><!-- Main Content -->
    <main class="main-content"><!-- Breadcrumb -->
     <div class="breadcrumb" id="breadcrumb"></div><!-- Page Header -->
     <div class="page-header">
      <h2 class="page-title" id="pageTitle">Kategori Saya</h2>
      <p class="page-subtitle" id="pageSubtitle">Kelola wishlist Anda berdasarkan kategori</p>
     </div><!-- Action Buttons -->
     <div class="action-buttons" id="actionButtons"><button class="btn-add" id="btnAddCategory">+ Tambah Kategori</button>
     </div><!-- Categories Grid -->
     <div class="category-grid" id="categoryGrid"></div><!-- Items Grid -->
     <div class="item-grid" id="itemGrid"></div><!-- Empty State -->
     <div class="empty-state" id="emptyState" style="display: none;">
      <h3>Belum ada data</h3>
      <p>Mulai dengan menambahkan kategori atau barang baru</p>
     </div>
    </main>
   </div><!-- Modal Add Category -->
   <div id="modalCategory" class="modal">
    <div class="modal-content">
     <div class="modal-header">
      <h3 class="modal-title" id="modalCategoryTitle">Tambah Kategori</h3>
     </div>
     <form id="formCategory">
      <div class="form-group"><label>Nama Kategori</label> <input type="text" id="categoryName" placeholder="Contoh: Pakaian, Teknologi" required>
      </div>
      <div class="form-group"><label>Cover Image</label>
       <div class="image-upload-container"><label for="categoryCoverInput" class="image-upload">
         <div id="categoryCoverPlaceholder">
          ðŸ“¸ Klik untuk upload gambar<br><span style="font-size: 12px; color: #999;">atau drag &amp; drop di sini</span>
         </div><img id="categoryCoverPreview" class="image-preview" style="display: none;"> </label> <input type="file" id="categoryCoverInput" accept="image/*">
       </div>
      </div>
      <div class="modal-actions"><button type="button" class="btn-cancel" id="btnCancelCategory">Batal</button> <button type="submit" class="btn-primary">Simpan</button>
      </div>
     </form>
    </div>
   </div><!-- Modal Add Item -->
   <div id="modalItem" class="modal">
    <div class="modal-content">
     <div class="modal-header">
      <h3 class="modal-title">Tambah Barang</h3>
     </div>
     <form id="formItem">
      <div class="form-group"><label>Nama Barang</label> <input type="text" id="itemName" placeholder="Contoh: Dress Midi" required>
      </div>
      <div class="form-group"><label>Deskripsi / Catatan</label> <textarea id="itemDescription" placeholder="Tambahkan catatan tentang barang ini"></textarea>
      </div>
      <div class="form-group"><label>Harga (Rp)</label> <input type="number" id="itemPrice" placeholder="0" required min="0">
      </div>
      <div class="form-group"><label>Tingkat Kepentingan</label> <select id="itemPriority" required> <option value="very-important">Sangat Penting</option> <option value="important">Penting</option> <option value="medium">Tidak Terlalu Penting</option> <option value="low">Tidak Penting</option> </select>
      </div>
      <div class="form-group"><label>Link Pembelian</label> <input type="url" id="itemLink" placeholder="https://tokopedia.com/...">
      </div>
      <div class="form-group"><label>Gambar Barang</label>
       <div class="image-upload-container"><label for="itemImageInput" class="image-upload">
         <div id="itemImagePlaceholder">
          ðŸ“¸ Klik untuk upload gambar<br><span style="font-size: 12px; color: #999;">atau drag &amp; drop di sini</span>
         </div><img id="itemImagePreview" class="image-preview" style="display: none;"> </label> <input type="file" id="itemImageInput" accept="image/*">
       </div>
      </div>
      <div class="modal-actions"><button type="button" class="btn-cancel" id="btnCancelItem">Batal</button> <button type="submit" class="btn-primary">Simpan</button>
      </div>
     </form>
    </div>
   </div>
  </div>
  <script>
    // Global state
    let currentUser = null;
    let allRecords = [];
    let currentPath = [];
    let isLoading = false;
    let sdkInitialized = false;

    // UI Helper Functions
    function showLoading() {
      isLoading = true;
      document.getElementById('loadingOverlay').classList.add('active');
    }

    function hideLoading() {
      isLoading = false;
      document.getElementById('loadingOverlay').classList.remove('active');
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} active`;
      
      setTimeout(() => {
        toast.classList.remove('active');
      }, 3000);
    }

    function showError(message) {
      const errorMessage = document.getElementById('errorMessage');
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      document.getElementById('successMessage').style.display = 'none';
    }

    function showSuccess(message) {
      const successMessage = document.getElementById('successMessage');
      successMessage.textContent = message;
      successMessage.style.display = 'block';
      document.getElementById('errorMessage').style.display = 'none';
    }

    function clearMessages() {
      document.getElementById('errorMessage').style.display = 'none';
      document.getElementById('successMessage').style.display = 'none';
    }

    // Toggle Password Visibility
    function togglePassword(inputId, button) {
      const input = document.getElementById(inputId);
      if (input.type === 'password') {
        input.type = 'text';
        button.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
            <line x1="1" y1="1" x2="23" y2="23"></line>
          </svg>
        `;
      } else {
        input.type = 'password';
        button.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        `;
      }
    }

    // Dark Mode Toggle
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      const btn = document.getElementById('btnDarkMode');
      
      if (isDark) {
        btn.textContent = 'â˜€ï¸';
        localStorage.setItem('wishlist_dark_mode', 'true');
      } else {
        btn.textContent = 'ðŸŒ™';
        localStorage.setItem('wishlist_dark_mode', 'false');
      }
    }

    function loadDarkModePreference() {
      const isDark = localStorage.getItem('wishlist_dark_mode') === 'true';
      if (isDark) {
        document.body.classList.add('dark-mode');
        const btn = document.getElementById('btnDarkMode');
        if (btn) btn.textContent = 'â˜€ï¸';
      }
    }

    // Local Storage Manager (for user credentials only)
    class StorageManager {
      static getUsers() {
        return JSON.parse(localStorage.getItem('wishlist_users') || '[]');
      }

      static saveUsers(users) {
        localStorage.setItem('wishlist_users', JSON.stringify(users));
      }

      static getCurrentUser() {
        return localStorage.getItem('wishlist_current_user');
      }

      static setCurrentUser(username) {
        localStorage.setItem('wishlist_current_user', username);
      }

      static clearCurrentUser() {
        localStorage.removeItem('wishlist_current_user');
      }
    }

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        allRecords = data.filter(record => record.username === currentUser);
        renderCurrentView();
      }
    };

    // Initialize Data SDK
    async function initDataSDK() {
      if (sdkInitialized) return true;
      
      // Wait for SDK to be available
      let attempts = 0;
      while (!window.dataSdk && attempts < 50) {
        await new Promise(resolve => setTimeout(resolve, 100));
        attempts++;
      }
      
      if (!window.dataSdk) {
        console.error('Data SDK tidak tersedia setelah 5 detik');
        return false;
      }

      try {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('SDK init gagal:', result.error);
          return false;
        }
        sdkInitialized = true;
        return true;
      } catch (error) {
        console.error('SDK Init Error:', error);
        return false;
      }
    }

    // Auth Functions
    async function handleLogin(e) {
      e.preventDefault();
      
      if (!sdkInitialized) {
        showError('Database belum siap. Mohon refresh halaman ini.');
        return;
      }
      
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;

      const users = StorageManager.getUsers();
      const user = users.find(u => u.username === username && u.password === password);

      if (user) {
        currentUser = username;
        StorageManager.setCurrentUser(username);
        showMainApp();
        renderHome();
      } else {
        showError('Username atau password salah');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      
      if (!sdkInitialized) {
        showError('Database belum siap. Mohon refresh halaman ini.');
        return;
      }
      
      const username = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('registerConfirmPassword').value;

      if (password !== confirmPassword) {
        showError('Password tidak cocok');
        return;
      }

      if (username.length < 3) {
        showError('Username minimal 3 karakter');
        return;
      }

      const users = StorageManager.getUsers();
      if (users.find(u => u.username === username)) {
        showError('Username sudah digunakan');
        return;
      }

      users.push({ username, password });
      StorageManager.saveUsers(users);

      showSuccess('Akun berhasil dibuat! Silakan login');
      document.getElementById('registerForm').reset();
      
      setTimeout(() => {
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('loginForm').style.display = 'block';
        clearMessages();
      }, 1500);
    }

    function handleLogout() {
      StorageManager.clearCurrentUser();
      currentUser = null;
      allRecords = [];
      currentPath = [];
      showAuthPage();
      document.getElementById('loginForm').reset();
    }

    function showAuthPage() {
      document.getElementById('authPage').style.display = 'flex';
      document.getElementById('mainApp').style.display = 'none';
    }

    function showMainApp() {
      document.getElementById('authPage').style.display = 'none';
      document.getElementById('mainApp').style.display = 'block';
    }

    // Data Structure Helpers
    function getUserCategories() {
      return allRecords.filter(r => r.type === 'category' && !r.parent_path);
    }

    function getSubcategories(parentPath) {
      return allRecords.filter(r => r.type === 'category' && r.parent_path === parentPath);
    }

    function getItems(categoryPath) {
      return allRecords.filter(r => r.type === 'item' && r.parent_path === categoryPath);
    }

    function getCategoryByPath(path) {
      const record = allRecords.find(r => r.parent_path === path && r.type === 'category');
      return record;
    }

    function getCategoryTotal(categoryPath) {
      let total = 0;
      
      // Items in this category
      const items = getItems(categoryPath);
      total += items.reduce((sum, item) => sum + (item.item_price || 0), 0);
      
      // Items in subcategories
      const subcategories = getSubcategories(categoryPath);
      subcategories.forEach(sub => {
        const subPath = sub.parent_path ? `${sub.parent_path}/${sub.category_name}` : sub.category_name;
        total += getCategoryTotal(subPath);
      });
      
      return total;
    }

    function getTotalPrice() {
      return allRecords
        .filter(r => r.type === 'item')
        .reduce((sum, item) => sum + (item.item_price || 0), 0);
    }

    // Navigation
    function renderHome() {
      currentPath = [];
      updateBreadcrumb();
      document.getElementById('pageTitle').textContent = 'Kategori Saya';
      document.getElementById('pageSubtitle').textContent = 'Kelola wishlist Anda berdasarkan kategori';
      
      document.getElementById('actionButtons').innerHTML = `
        <button class="btn-add" onclick="openModalCategory()">+ Tambah Kategori</button>
      `;

      const categories = getUserCategories();
      renderCategories(categories, '');
      document.getElementById('itemGrid').innerHTML = '';
      updateTotalPrice();
    }

    function navigateToCategory(path) {
      currentPath = path;
      
      const categories = getSubcategories(path);
      const items = getItems(path);
      const pathParts = path.split('/');
      const categoryName = pathParts[pathParts.length - 1];
      
      updateBreadcrumb();
      document.getElementById('pageTitle').textContent = categoryName;
      document.getElementById('pageSubtitle').textContent = `Total: ${formatPrice(getCategoryTotal(path))}`;

      document.getElementById('actionButtons').innerHTML = `
        <button class="btn-add" onclick="openModalCategory()">+ Tambah Sub-Kategori</button>
        <button class="btn-add" onclick="openModalItem()">+ Tambah Barang</button>
      `;

      if (categories.length > 0) {
        renderCategories(categories, path);
      } else {
        document.getElementById('categoryGrid').innerHTML = '';
      }

      if (items.length > 0) {
        renderItems(items);
      } else {
        document.getElementById('itemGrid').innerHTML = '';
      }

      if (categories.length === 0 && items.length === 0) {
        showEmptyState();
      } else {
        hideEmptyState();
      }

      updateTotalPrice();
    }

    function updateBreadcrumb() {
      const breadcrumb = document.getElementById('breadcrumb');
      
      if (!currentPath) {
        breadcrumb.innerHTML = '<span class="breadcrumb-item active">Home</span>';
        return;
      }

      let html = '<a class="breadcrumb-item" onclick="renderHome()">Home</a>';
      
      if (currentPath) {
        const parts = currentPath.split('/');
        let tempPath = '';
        
        parts.forEach((part, index) => {
          tempPath = tempPath ? `${tempPath}/${part}` : part;
          const isLast = index === parts.length - 1;
          
          html += '<span class="breadcrumb-separator">â€º</span>';
          
          if (isLast) {
            html += `<span class="breadcrumb-item active">${part}</span>`;
          } else {
            html += `<a class="breadcrumb-item" onclick="navigateToCategory('${tempPath}')">${part}</a>`;
          }
        });
      }

      breadcrumb.innerHTML = html;
    }

    function renderCurrentView() {
      if (!currentPath) {
        renderHome();
      } else {
        navigateToCategory(currentPath);
      }
    }

    // Render Functions
    function renderCategories(categories, parentPath) {
      const grid = document.getElementById('categoryGrid');
      
      if (!categories || categories.length === 0) {
        grid.innerHTML = '';
        return;
      }

      grid.innerHTML = categories.map(cat => {
        const catPath = parentPath ? `${parentPath}/${cat.category_name}` : cat.category_name;
        const total = getCategoryTotal(catPath);
        const coverStyle = cat.category_cover ? 
          `background-image: url('${cat.category_cover}'); background-size: cover; background-position: center;` :
          '';
        
        return `
          <div class="category-card" onclick="navigateToCategory('${catPath}')">
            <div class="category-cover" style="${coverStyle}"></div>
            <div class="category-info">
              <div class="category-name">${cat.category_name}</div>
              <div class="category-total">${formatPrice(total)}</div>
            </div>
            <div class="category-actions" onclick="event.stopPropagation()">
              <button class="btn-icon" onclick="deleteCategory('${cat.__backendId}')">Hapus</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderItems(items) {
      const grid = document.getElementById('itemGrid');
      
      if (!items || items.length === 0) {
        grid.innerHTML = '';
        return;
      }

      const sortedItems = [...items].sort((a, b) => {
        if (a.item_purchased === b.item_purchased) return 0;
        return a.item_purchased ? 1 : -1;
      });

      grid.innerHTML = sortedItems.map(item => {
        const priorityClass = `priority-${item.item_priority}`;
        const priorityText = {
          'very-important': 'Sangat Penting',
          'important': 'Penting',
          'medium': 'Sedang',
          'low': 'Rendah'
        }[item.item_priority];

        const imageStyle = item.item_image ? 
          `background-image: url('${item.item_image}'); background-size: cover; background-position: center;` :
          '';

        return `
          <div class="item-card ${item.item_purchased ? 'purchased' : ''}">
            <div class="item-image" style="${imageStyle}"></div>
            <div class="item-content">
              <div class="item-header">
                <div class="item-name">${item.item_name}</div>
                <div class="priority-badge ${priorityClass}">${priorityText}</div>
              </div>
              ${item.item_description ? `<div class="item-description">${item.item_description}</div>` : ''}
              <div class="item-price">${formatPrice(item.item_price)}</div>
              <div class="item-actions">
                ${item.item_link ? 
                  `<button class="btn-buy" onclick="window.open('${item.item_link}', '_blank', 'noopener,noreferrer')">Beli Sekarang</button>` :
                  '<button class="btn-buy" disabled style="opacity: 0.5;">Tidak Ada Link</button>'
                }
              </div>
              <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                <label class="checkbox-purchased">
                  <input type="checkbox" ${item.item_purchased ? 'checked' : ''} onchange="togglePurchased('${item.__backendId}')">
                  <span>${item.item_purchased ? 'Sudah Dibeli' : 'Belum Dibeli'}</span>
                </label>
                <div>
                  <button class="btn-icon" onclick="deleteItem('${item.__backendId}')" style="color: #C00000;">Hapus</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function showEmptyState() {
      document.getElementById('emptyState').style.display = 'block';
    }

    function hideEmptyState() {
      document.getElementById('emptyState').style.display = 'none';
    }

    function updateTotalPrice() {
      const total = getTotalPrice();
      document.getElementById('totalPrice').textContent = formatPrice(total);
    }

    function formatPrice(amount) {
      return 'Rp ' + amount.toLocaleString('id-ID');
    }

    // Modal Functions
    function openModalCategory() {
      document.getElementById('modalCategory').classList.add('active');
      document.getElementById('formCategory').reset();
      
      const preview = document.getElementById('categoryCoverPreview');
      const placeholder = document.getElementById('categoryCoverPlaceholder');
      preview.style.display = 'none';
      placeholder.style.display = 'block';
    }

    function openModalItem() {
      document.getElementById('modalItem').classList.add('active');
      document.getElementById('formItem').reset();
      
      const preview = document.getElementById('itemImagePreview');
      const placeholder = document.getElementById('itemImagePlaceholder');
      preview.style.display = 'none';
      placeholder.style.display = 'block';
    }

    function closeModal(modal) {
      modal.classList.remove('active');
    }

    // Handle Image Upload
    function handleImageUpload(event, previewId, placeholderId) {
      const file = event.target.files[0];
      if (!file) return;

      if (file.size > 2 * 1024 * 1024) {
        showToast('Ukuran gambar terlalu besar! Maksimal 2MB', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.getElementById(previewId);
        const placeholder = document.getElementById(placeholderId);
        
        preview.src = e.target.result;
        preview.style.display = 'block';
        placeholder.style.display = 'none';
      };
      reader.readAsDataURL(file);
    }

    // Save Category
    async function handleSaveCategory(e) {
      e.preventDefault();
      
      if (!sdkInitialized) {
        showToast('Database belum siap. Mohon refresh halaman.', 'error');
        return;
      }
      
      if (allRecords.length >= 999) {
        showToast('Batas maksimal 999 data tercapai!', 'error');
        return;
      }

      showLoading();

      const name = document.getElementById('categoryName').value.trim();
      const coverPreview = document.getElementById('categoryCoverPreview');
      const cover = coverPreview.style.display === 'block' ? coverPreview.src : '';

      const parentPath = currentPath || '';
      
      const newCategory = {
        username: currentUser,
        type: 'category',
        parent_path: parentPath,
        category_name: name,
        category_cover: cover,
        created_at: new Date().toISOString()
      };

      const result = await window.dataSdk.create(newCategory);
      
      hideLoading();

      if (result.isOk) {
        showToast('Kategori berhasil ditambahkan!');
        closeModal(document.getElementById('modalCategory'));
      } else {
        showToast('Gagal menambahkan kategori', 'error');
      }
    }

    // Save Item
    async function handleSaveItem(e) {
      e.preventDefault();
      
      if (!sdkInitialized) {
        showToast('Database belum siap. Mohon refresh halaman.', 'error');
        return;
      }
      
      if (allRecords.length >= 999) {
        showToast('Batas maksimal 999 data tercapai!', 'error');
        return;
      }

      showLoading();

      const imagePreview = document.getElementById('itemImagePreview');
      const image = imagePreview.style.display === 'block' ? imagePreview.src : '';

      const newItem = {
        username: currentUser,
        type: 'item',
        parent_path: currentPath,
        item_name: document.getElementById('itemName').value.trim(),
        item_description: document.getElementById('itemDescription').value.trim(),
        item_price: parseInt(document.getElementById('itemPrice').value) || 0,
        item_priority: document.getElementById('itemPriority').value,
        item_link: document.getElementById('itemLink').value.trim(),
        item_image: image,
        item_purchased: false,
        created_at: new Date().toISOString()
      };

      const result = await window.dataSdk.create(newItem);
      
      hideLoading();

      if (result.isOk) {
        showToast('Barang berhasil ditambahkan!');
        closeModal(document.getElementById('modalItem'));
      } else {
        showToast('Gagal menambahkan barang', 'error');
      }
    }

    // Delete Category
    async function deleteCategory(backendId) {
      if (!sdkInitialized) {
        showToast('Database belum siap.', 'error');
        return;
      }
      
      const record = allRecords.find(r => r.__backendId === backendId);
      if (!record) return;

      const categoryPath = record.parent_path ? `${record.parent_path}/${record.category_name}` : record.category_name;
      
      // Check if has children
      const hasChildren = allRecords.some(r => r.parent_path && r.parent_path.startsWith(categoryPath));
      
      if (hasChildren) {
        showToast('Hapus dulu semua sub-kategori dan barang di dalamnya', 'error');
        return;
      }

      showLoading();
      const result = await window.dataSdk.delete(record);
      hideLoading();

      if (result.isOk) {
        showToast('Kategori berhasil dihapus!');
      } else {
        showToast('Gagal menghapus kategori', 'error');
      }
    }

    // Delete Item
    async function deleteItem(backendId) {
      if (!sdkInitialized) {
        showToast('Database belum siap.', 'error');
        return;
      }
      
      const record = allRecords.find(r => r.__backendId === backendId);
      if (!record) return;

      showLoading();
      const result = await window.dataSdk.delete(record);
      hideLoading();

      if (result.isOk) {
        showToast('Barang berhasil dihapus!');
      } else {
        showToast('Gagal menghapus barang', 'error');
      }
    }

    // Toggle Purchased
    async function togglePurchased(backendId) {
      if (!sdkInitialized) {
        showToast('Database belum siap.', 'error');
        return;
      }
      
      const record = allRecords.find(r => r.__backendId === backendId);
      if (!record) return;

      showLoading();
      
      const updatedRecord = {
        ...record,
        item_purchased: !record.item_purchased
      };

      const result = await window.dataSdk.update(updatedRecord);
      hideLoading();

      if (!result.isOk) {
        showToast('Gagal mengupdate status', 'error');
      }
    }

    // Initialize App
    async function init() {
      loadDarkModePreference();
      
      // Initialize SDK FIRST
      showLoading();
      const sdkReady = await initDataSDK();
      hideLoading();
      
      if (!sdkReady) {
        showToast('Gagal terhubung ke database. Silakan refresh halaman ini.', 'error');
        showAuthPage();
        setupEventListeners();
        return;
      }
      
      const savedUser = StorageManager.getCurrentUser();
      if (savedUser) {
        currentUser = savedUser;
        showMainApp();
        renderHome();
      } else {
        showAuthPage();
      }
      
      setupEventListeners();
    }

    function setupEventListeners() {
      // Auth
      document.getElementById('showRegister').addEventListener('click', () => {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = 'block';
        clearMessages();
      });

      document.getElementById('showLogin').addEventListener('click', () => {
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('loginForm').style.display = 'block';
        clearMessages();
      });

      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.getElementById('registerForm').addEventListener('submit', handleRegister);
      document.getElementById('btnLogout').addEventListener('click', handleLogout);

      // Dark Mode
      document.getElementById('btnDarkMode').addEventListener('click', toggleDarkMode);

      // Modals
      document.getElementById('btnCancelCategory').addEventListener('click', () => 
        closeModal(document.getElementById('modalCategory'))
      );
      document.getElementById('btnCancelItem').addEventListener('click', () => 
        closeModal(document.getElementById('modalItem'))
      );
      
      document.getElementById('formCategory').addEventListener('submit', handleSaveCategory);
      document.getElementById('formItem').addEventListener('submit', handleSaveItem);

      // Image uploads
      document.getElementById('categoryCoverInput').addEventListener('change', (e) => {
        handleImageUpload(e, 'categoryCoverPreview', 'categoryCoverPlaceholder');
      });

      document.getElementById('itemImageInput').addEventListener('change', (e) => {
        handleImageUpload(e, 'itemImagePreview', 'itemImagePlaceholder');
      });

      // Close modal on background click
      document.getElementById('modalCategory').addEventListener('click', (e) => {
        if (e.target.id === 'modalCategory') closeModal(e.target);
      });
      document.getElementById('modalItem').addEventListener('click', (e) => {
        if (e.target.id === 'modalItem') closeModal(e.target);
      });
    }

    // Start the app
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b310920a2d1fe14',t:'MTc2NjU4OTEzMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
